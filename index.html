<?php
session_start();

// Daftar harga bahan
$harga = [
    "Kunyit" => 1500,
    "Jahe" => 1000,
    "Madu" => 2200,
    "Mengkudu" => 1200,
    "Serai" => 900,
    "Kapulaga" => 1000,
    "Stevia" => 1200,
    "Daun Pandan" => 800,
    "Delima" => 1800,
];

// Inisialisasi keranjang
if (!isset($_SESSION['keranjang'])) {
    $_SESSION['keranjang'] = [];
}

// Tambah ke keranjang
if (isset($_POST['tambah'])) {
    $bahanTerpilih = $_POST['bahan'] ?? [];
    $porsi = intval($_POST['porsi'] ?? 1);
    foreach ($bahanTerpilih as $bahan) {
        $_SESSION['keranjang'][$bahan] = $porsi;
    }
}

// Hapus bahan tertentu
if (isset($_POST['hapus_bahan'])) {
    $bahanHapus = $_POST['hapus_bahan'];
    unset($_SESSION['keranjang'][$bahanHapus]);
}

// Reset keranjang
if (isset($_POST['reset'])) {
    $_SESSION['keranjang'] = [];
}

// Hitung total
$total = 0;
foreach ($_SESSION['keranjang'] as $bahan => $porsi) {
    if (isset($harga[$bahan])) {
        $total += $harga[$bahan] * $porsi;
    }
}
?>

<!DOCTYPE html>
<html>
<head>
    <title>Form Pemesanan Jamu</title>
</head>
<body>
    <h1>Form Pemesanan Jamu</h1>

    <!-- Form Pemesanan -->
    <form method="post">
        <p><strong>Pilih Bahan:</strong></p>
        <?php foreach ($harga as $bahan => $nilai): ?>
            <label>
                <input type="checkbox" name="bahan[]" value="<?= $bahan ?>">
                <?= $bahan ?> (<?= $nilai ?>)
            </label><br>
        <?php endforeach; ?>

        <p>
            <label>Jumlah Porsi: 
                <input type="number" name="porsi" value="1" min="1" required>
            </label>
        </p>

        <button type="submit" name="tambah">Tambah ke Keranjang</button>
        <button type="submit" name="reset">Reset Keranjang</button>
    </form>

    <!-- Keranjang Belanja -->
    <h2>Keranjang Belanja</h2>
    <?php if (!empty($_SESSION['keranjang'])): ?>
        <ul>
            <?php foreach ($_SESSION['keranjang'] as $bahan => $porsi): ?>
                <li>
                    <?= $bahan ?> (<?= $porsi ?> porsi) - <?= $harga[$bahan] * $porsi ?>
                    <form method="post" style="display:inline;">
                        <input type="hidden" name="hapus_bahan" value="<?= $bahan ?>">
                        <button type="submit">Hapus</button>
                    </form>
                </li>
            <?php endforeach; ?>
        </ul>
    <?php else: ?>
        <p><em>Keranjang kosong.</em></p>
    <?php endif; ?>

    <p><strong>Total Belanja: <?= $total ?></strong></p>
</body>
</html>

